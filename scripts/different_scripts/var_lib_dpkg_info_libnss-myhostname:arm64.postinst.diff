--- /media/mks/5dcae443-0796-4029-ae6c-bf5bd2a37067/var/lib/dpkg/info/libnss-myhostname:arm64.postinst	2021-07-08 09:03:45.000000000 -0400
+++ /media/mks/armbi_root/var/lib/dpkg/info/libnss-myhostname:arm64.postinst	2024-06-16 05:44:31.000000000 -0400
@@ -1,40 +1,11 @@
 #!/bin/sh
 set -e
-
-# This code was taken from libnss-myhostname
-
-# try to insert myhostname entries to the "hosts" line in /etc/nsswitch.conf to
-# automatically enable libnss-myhostname support; do not change the
-# configuration if the "hosts" line already references some myhostname lookups
-insert_nss_entry() {
-    echo "Checking NSS setup..."
-    # abort if /etc/nsswitch.conf does not exist
-    if ! [ -e /etc/nsswitch.conf ]; then
-        echo "Could not find /etc/nsswitch.conf."
-        return
-    fi
-    perl -i -pe '
-        sub insert {
-            my $line = shift;
-            # this also splits on tab
-            my @bits=split(" ", $line);
-            # do not break configuration if the "hosts" line already references
-            # myhostname
-            if (grep { $_ eq "myhostname"} @bits) {
-                return $line;
-            }
-            # add myhostname at the end
-            return $line . " myhostname";
-        }
-        s/^(hosts:\s+)(.*)/$1.insert($2)/e;
-    ' /etc/nsswitch.conf
-}
-
-if [ "$1" = configure ] && [ -z "$2" ]; then
-    echo "First installation detected..."
-    # first install: setup the recommended configuration (unless
-    # nsswitch.conf already contains myhostname entries)
-    insert_nss_entry
+# Automatically added by dh_installnss/1.7
+if [ "$1" = "configure" ] && [ -f "${DPKG_ROOT}/etc/nsswitch.conf.nss.${DPKG_MAINTSCRIPT_PACKAGE}-will-install" ] && [ -e "${DPKG_ROOT}/etc/nsswitch.conf" ] ; then
+	if ! grep -q -E  -e '^hosts:[^#]*\s(myhostname)(\s|#|$)' "${DPKG_ROOT}/etc/nsswitch.conf" ; then
+		# Installing hosts/myhostname from libnss-myhostname in position after=files
+		sed -E -i "${DPKG_ROOT}/etc/nsswitch.conf" -e '/^hosts:\s[^#]*$/ s/(\s)(files(\s+\[[^]]+\])?)(\s|$)/\1\2 myhostname /' -e '/^hosts:\s.*#/ s/(\s)(files(\s+\[[^]]+\])?)(\s|#)/\1\2 myhostname \3/' -e 's/ $//'
+	fi
+	rm "${DPKG_ROOT}/etc/nsswitch.conf.nss.${DPKG_MAINTSCRIPT_PACKAGE}-will-install"
 fi
-
-
+# End automatically added section
