--- /media/mks/5dcae443-0796-4029-ae6c-bf5bd2a37067/usr/lib/sysstat/sa2	2019-04-06 03:18:26.000000000 -0400
+++ /media/mks/armbi_root/usr/lib/sysstat/sa2	2022-12-04 16:23:25.000000000 -0500
@@ -1,22 +1,35 @@
-#!/bin/sh
+#!/bin/bash
 # /usr/lib/sysstat/sa2
-# (C) 1999-2018 Sebastien Godard (sysstat <at> orange.fr)
+# (C) 1999-2022 Sebastien Godard (sysstat <at> orange.fr)
 #
-#@(#) sysstat-12.0.3
+#@(#) sysstat-12.6.1
 #@(#) sa2: Write a daily report
 #
 S_TIME_FORMAT=ISO ; export S_TIME_FORMAT
-umask 0022
 prefix=/usr
 exec_prefix=${prefix}
 SA_DIR=/var/log/sysstat
 SYSCONFIG_DIR=/etc/sysstat
+SYSCONFIG_FILE=sysstat
 HISTORY=7
 COMPRESSAFTER=10
 ZIP="xz"
+UMASK=0022
+ENDIR=
+DELAY_RANGE=0
 
 # Read configuration file, overriding variables set above
-[ -r ${SYSCONFIG_DIR}/sysstat ] && . ${SYSCONFIG_DIR}/sysstat
+[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}
+
+umask ${UMASK}
+
+# Wait for a random delay if requested
+if [ ${DELAY_RANGE} -gt 0 ]
+then
+	RANDOM=$$
+	DELAY=$((${RANDOM}%${DELAY_RANGE}))
+	sleep ${DELAY}
+fi
 
 [ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat
 
@@ -39,7 +52,10 @@
 
 RPT=${SA_DIR}/${CURRENTRPT}
 DFILE=${SA_DIR}/${CURRENTFILE}
-ENDIR=${exec_prefix}/bin
+if [ -z "${ENDIR}" ];
+then
+       ENDIR=${exec_prefix}/bin
+fi
 
 [ -f "${DFILE}" ] || exit 0
 cd ${ENDIR}
@@ -51,14 +67,13 @@
 SAFILES_REGEX='/sar?[0-9]{2,8}(\.(Z|gz|bz2|xz|lz|lzo))?$'
 
 find "${SA_DIR}" -type f -mtime +${HISTORY} \
-	| egrep "${SAFILES_REGEX}" \
+	| grep -E "${SAFILES_REGEX}" \
 	| xargs   rm -f
 
 UNCOMPRESSED_SAFILES_REGEX='/sar?[0-9]{2,8}$'
 
 find "${SA_DIR}" -type f -mtime +${COMPRESSAFTER} \
-	| egrep "${UNCOMPRESSED_SAFILES_REGEX}" \
-	| xargs   "${ZIP}" > /dev/null
+	| grep -E "${UNCOMPRESSED_SAFILES_REGEX}" \
+	| xargs -r "${ZIP}" > /dev/null
 
 exit 0
-
