--- /media/mks/5dcae443-0796-4029-ae6c-bf5bd2a37067/etc/X11/Xsession	2016-11-23 02:30:35.000000000 -0500
+++ /media/mks/armbi_root/etc/X11/Xsession	2021-08-18 06:58:20.000000000 -0400
@@ -15,7 +15,7 @@
   # is available and $DISPLAY is set
   MESSAGE="$PROGNAME: $*"
   echo "$MESSAGE" | fold -s -w ${COLUMNS:-80} >&2
-  if [ -n "$DISPLAY" ] && which xmessage > /dev/null 2>&1; then
+  if [ -n "$DISPLAY" ] && command -v xmessage > /dev/null 2>&1; then
     echo "$MESSAGE" | fold -s -w ${COLUMNS:-80} | xmessage -center -file -
   fi
 }
@@ -25,7 +25,7 @@
   # xmessage if it is available and $DISPLAY is set
   MESSAGE="$PROGNAME: $*"
   echo -n "$MESSAGE" | fold -s -w ${COLUMNS:-80} >&2;
-  if [ -n "$DISPLAY" ] && which xmessage > /dev/null 2>&1; then
+  if [ -n "$DISPLAY" ] && command -v xmessage > /dev/null 2>&1; then
     echo -n "$MESSAGE" | fold -s -w ${COLUMNS:-80} | xmessage -center -file -
   fi
 }
@@ -60,11 +60,29 @@
 ALTUSERXSESSION=$HOME/.Xsession
 ERRFILE=$HOME/.xsession-errors
 
+OPTIONS="$(
+  if [ -r "$OPTIONFILE" ]; then
+    cat "$OPTIONFILE"
+  fi
+  if [ -d /etc/X11/Xsession.options.d ]; then
+    run-parts --list --regex '\.conf$' /etc/X11/Xsession.options.d | xargs -d '\n' cat
+  fi
+)"
+
+has_option() {
+  # Ensure that a later no-foo overrides an earlier foo
+  if [ "$(echo "$OPTIONS" | grep -Eo "^(no-)?$1\>" | tail -n 1)" = "$1" ]; then
+    return 0
+  else
+    return 1
+  fi
+}
+
 # attempt to create an error file; abort if we cannot
 if (umask 077 && touch "$ERRFILE") 2> /dev/null && [ -w "$ERRFILE" ] &&
   [ ! -L "$ERRFILE" ]; then
   chmod 600 "$ERRFILE"
-elif ERRFILE=$(tempfile 2> /dev/null); then
+elif ERRFILE=$(mktemp 2> /dev/null); then
   if ! ln -sf "$ERRFILE" "${TMPDIR:=/tmp}/xsession-$USER"; then
     message "warning: unable to symlink \"$TMPDIR/xsession-$USER\" to" \
              "\"$ERRFILE\"; look for session log/errors in" \
@@ -86,9 +104,9 @@
 # Attempt to create a file of non-zero length in /tmp; a full filesystem can
 # cause mysterious X session failures.  We do not use touch, :, or test -w
 # because they won't actually create a file with contents.  We also let standard
-# error from tempfile and echo go to the error file to aid the user in
+# error from mktemp and echo go to the error file to aid the user in
 # determining what went wrong.
-WRITE_TEST=$(tempfile)
+WRITE_TEST=$(mktemp)
 if ! echo "*" >>"$WRITE_TEST"; then
   message "warning: unable to write to ${WRITE_TEST%/*}; X session may exit" \
           "with an error"
