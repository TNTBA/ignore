--- /media/mks/5dcae443-0796-4029-ae6c-bf5bd2a37067/var/lib/dpkg/info/libglib2.0-0:arm64.postinst	2021-03-27 07:34:13.000000000 -0400
+++ /media/mks/armbi_root/var/lib/dpkg/info/libglib2.0-0:arm64.postinst	2024-05-14 06:11:32.000000000 -0400
@@ -17,19 +17,11 @@
             "/usr/lib/aarch64-linux-gnu/glib-2.0/glib-compile-schemas" /usr/share/glib-2.0/schemas || true
             ;;
 
-          "/usr/lib/aarch64-linux-gnu/gio/modules"|/usr/lib/gio/modules)
+          "/usr/lib/aarch64-linux-gnu/gio/modules")
             # This is triggered everytime an application installs a GIO
-            # module into /usr/lib/aarch64-linux-gnu/gio/modules or the
-            # backwards-compatible /usr/lib/gio/modules directory
+            # module into /usr/lib/aarch64-linux-gnu/gio/modules
 
-            # The /usr/lib/gio/modules directory is no longer shipped by
-            # libglib2.0 itself so we need to check to avoid a warning from
-            # gio-querymodules
-            dirs="/usr/lib/aarch64-linux-gnu/gio/modules"
-            if [ -d /usr/lib/gio/modules ] && [ $(dpkg --print-architecture) = "arm64" ]; then
-                dirs="$dirs /usr/lib/gio/modules"
-            fi
-            "/usr/lib/aarch64-linux-gnu/glib-2.0/gio-querymodules" $dirs || true
+            "/usr/lib/aarch64-linux-gnu/glib-2.0/gio-querymodules" "/usr/lib/aarch64-linux-gnu/gio/modules" || true
             ;;
         esac
     done
@@ -42,15 +34,19 @@
 
 
 
-# Also handle the initial installation
-if [ -d /usr/share/glib-2.0/schemas ]; then
-    "/usr/lib/aarch64-linux-gnu/glib-2.0/glib-compile-schemas" /usr/share/glib-2.0/schemas || true
-fi
-if [ -d "/usr/lib/aarch64-linux-gnu/gio/modules" ]; then
-    "/usr/lib/aarch64-linux-gnu/glib-2.0/gio-querymodules" "/usr/lib/aarch64-linux-gnu/gio/modules" || true
-fi
-if [ -d /usr/lib/gio/modules ] && [ $(dpkg --print-architecture) = "arm64" ]; then
-    "/usr/lib/aarch64-linux-gnu/glib-2.0/gio-querymodules" /usr/lib/gio/modules || true
+# This is shipped in the .deb (see debian/libglib2.0-0.dirs) but would
+# be removed if empty during upgrade by old versions of the postrm (#987913).
+# This workaround can be removed after Debian 12 and Ubuntu 22.04 are released.
+install -d "/usr/lib/aarch64-linux-gnu/gio/modules"
+
+"/usr/lib/aarch64-linux-gnu/glib-2.0/glib-compile-schemas" /usr/share/glib-2.0/schemas || true
+"/usr/lib/aarch64-linux-gnu/glib-2.0/gio-querymodules" "/usr/lib/aarch64-linux-gnu/gio/modules" || true
+
+# Clean up pre-multiarch giomodule.cache.
+# This workaround can be removed after Debian 12 and Ubuntu 22.04 are released.
+if [ -d /usr/lib/gio/modules ]; then
+    rm -f /usr/lib/gio/modules/giomodule.cache
+    rmdir -p --ignore-fail-on-non-empty /usr/lib/gio/modules
 fi
 
 # vim:set sw=4 sts=4 et:
