--- /media/mks/5dcae443-0796-4029-ae6c-bf5bd2a37067/var/lib/dpkg/info/libnss-myhostname:arm64.postrm	2021-07-08 09:03:45.000000000 -0400
+++ /media/mks/armbi_root/var/lib/dpkg/info/libnss-myhostname:arm64.postrm	2024-06-16 05:44:31.000000000 -0400
@@ -1,28 +1,12 @@
 #!/bin/sh
 set -e
-
-remove_nss_entry() {
-    local file=$1
-    local pkg=$2
-    local module=$3
-    refcount=$(dpkg-query -f '${db:Status-Abbrev} ${binary:Package}\n' \
-        -W $pkg | grep '^i' | wc -l)
-    if [ "$refcount" -gt 0 ] ; then
-        # package is installed for other architectures still, do nothing
-        return
-    fi
-    echo "Checking NSS setup..."
-    # abort if file does not exist
-    if ! [ -e $file ]; then
-        echo "Could not find ${file}."
-        return
-    fi
-    # we must remove possible [foo=bar] options as well
-    sed -i -r "/hosts:/ s/[[:space:]]+$module\b([[:space:]]*\[[^]]*\])*//" $file
-}
-
-if [ "$1" = remove ]; then
-    remove_nss_entry /etc/nsswitch.conf libnss-myhostname myhostname
+# Automatically added by dh_installnss/1.7
+: "${DPKG_MAINTSCRIPT_PACKAGE_INSTCOUNT:=$(dpkg-query -f '${db:Status-Abbrev}\n' -W "$DPKG_MAINTSCRIPT_PACKAGE" | grep -c '^i')}"
+if { [ "$1" = "remove" ] || [ "$1" = "purge" ] ; } && [ -e "${DPKG_ROOT}/etc/nsswitch.conf" ] && [ "$DPKG_MAINTSCRIPT_PACKAGE_INSTCOUNT" -eq 0 ] ; then
+	sed -E -i "${DPKG_ROOT}/etc/nsswitch.conf" \
+		-e ':a /^hosts:\s.*#/ s/(^[^#]+)\s(myhostname)\s+\[!?[A-Za-z]+=[A-Za-z]+\](\s|#)/\1\3/g ; t a' \
+		-e ':b /^hosts:\s.*#/ s/(^[^#]+)\s(myhostname)(\s|#)/\1\3/g ; t b' \
+		-e ':c /^hosts:\s[^#]*$/ s/\s(myhostname)\s+\[!?[A-Za-z]+=[A-Za-z]+\](\s|$)/\2/g ; t c' \
+		-e ':d /^hosts:\s[^#]*$/ s/\s(myhostname)(\s|$)/\2/g ; t d'
 fi
-
-
+# End automatically added section
