--- /media/mks/5dcae443-0796-4029-ae6c-bf5bd2a37067/var/lib/dpkg/info/dbus.postinst	2020-07-05 12:10:45.000000000 -0400
+++ /media/mks/armbi_root/var/lib/dpkg/info/dbus.postinst	2023-09-16 06:03:58.000000000 -0400
@@ -5,7 +5,6 @@
 set -e
 
 MESSAGEUSER=messagebus
-MESSAGEHOME=/var/run/dbus
 LAUNCHER=/usr/lib/dbus-1.0/dbus-daemon-launch-helper
 
 # This is what the init script would do, but it's simpler (and less
@@ -24,25 +23,13 @@
 fi
 
 if [ "$1" = configure ]; then
-    adduser --system \
-            --quiet \
-            --home /nonexistent \
-            --no-create-home \
-            --disabled-password \
-            --group "$MESSAGEUSER"
-
+    # This respects $DPKG_ROOT
     if ! dpkg-statoverride --list "$LAUNCHER" >/dev/null; then
         dpkg-statoverride --update --add root "$MESSAGEUSER" 4754 "$LAUNCHER"
     fi
-
-    # This is idempotent, so it's OK to do every time. The system bus' init
-    # script does this anyway, but you also have to do this before a session
-    # bus will work, so we do this here for the benefit of people starting
-    # a temporary session bus in a chroot
-    dbus-uuidgen --ensure
 fi
 
-if [ "$1" = configure ] && [ -n "$2" ]; then
+if [ -z "${DPKG_ROOT:-}" ] && [ "$1" = configure ] && [ -n "$2" ]; then
     # On upgrades, we only reload config, and don't restart (restarting the
     # system bus is not supported by upstream). The code added by
     # dh_installinit -r creates a start action, below.
@@ -64,42 +51,29 @@
         # (used by unattended-upgrades etc.)
         touch /var/run/reboot-required || true
 
+        if ! grep -Fqsx dbus /run/reboot-required.pkgs; then
+            echo dbus >> /run/reboot-required.pkgs || true
+        fi
+
         # same thing for the older update-notifier interface
         [ -x /usr/share/update-notifier/notify-reboot-required ] && \
             /usr/share/update-notifier/notify-reboot-required || true
     fi
-
-    # Clean up old compatibility symlinks that were used to upgrade from
-    # Debian 8 to Debian 9. This can be dropped after Debian 10 is released.
-    for bus in system session; do
-        conf="/etc/dbus-1/${bus}.conf"
-        exp_target="/usr/share/dbus-1/${bus}.conf"
-        target="$(readlink -f "${conf}")" || continue
-
-        if [ -h "${conf}" ] && [ "_${target}" = "_${exp_target}" ]; then
-            rm -f "${conf}"
-        fi
-    done
 fi
 
-# Automatically added by dh_installsystemd/12.1.1
+# Automatically added by dh_installinit/13.11.4
 if [ "$1" = "configure" ] || [ "$1" = "abort-upgrade" ] || [ "$1" = "abort-deconfigure" ] || [ "$1" = "abort-remove" ] ; then
-	# In case this system is running systemd, we need to ensure that all
-	# necessary tmpfiles (if any) are created before starting.
-	if [ -d /run/systemd/system ] ; then
-		systemd-tmpfiles --create dbus.conf >/dev/null || true
+	if [ -z "${DPKG_ROOT:-}" ] && [ -x "/etc/init.d/dbus" ]; then
+		update-rc.d dbus defaults >/dev/null
+		invoke-rc.d --skip-systemd-native dbus start || exit 1
 	fi
 fi
 # End automatically added section
-# Automatically added by dh_installdeb/12.1.1
-dpkg-maintscript-helper rm_conffile /etc/dbus-1/session.conf 1.10.0-4\~ dbus -- "$@"
-dpkg-maintscript-helper rm_conffile /etc/dbus-1/system.conf 1.10.0-4\~ dbus -- "$@"
-# End automatically added section
-# Automatically added by dh_installinit/12.1.1
+# Automatically added by dh_installsystemd/13.11.4
 if [ "$1" = "configure" ] || [ "$1" = "abort-upgrade" ] || [ "$1" = "abort-deconfigure" ] || [ "$1" = "abort-remove" ] ; then
-	if [ -x "/etc/init.d/dbus" ]; then
-		update-rc.d dbus defaults >/dev/null
-		invoke-rc.d dbus start || exit 1
+	if [ -z "${DPKG_ROOT:-}" ] && [ -d /run/systemd/system ]; then
+		systemctl --system daemon-reload >/dev/null || true
+		deb-systemd-invoke start 'dbus.service' >/dev/null || true
 	fi
 fi
 # End automatically added section
@@ -108,6 +82,8 @@
 # Do this after the debhelper-generated bits so that dpkg-maintscript-helper
 # will have finished moving configuration files around. We only need to do
 # this for upgrades, not new installations.
-if [ "$1" = configure ] && [ -n "$2" ]; then
+if [ -z "${DPKG_ROOT:-}" ] && [ "$1" = configure ] && [ -n "$2" ]; then
     reload_dbus_config
 fi
+
+# vim:set sw=4 sts=4 et:
